[![npm version](https://badge.fury.io/js/@wixc3%2Ftesting.svg)](https://badge.fury.io/js/@wixc3%2Ftesting)
[@wixc3/testing on Github](https://github.com/wixplosives/core3-utils/tree/master/packages/testing)

<!-- Do not edit this file. It is automatically generated by API Documenter. -->

[Home](https://wixplosives.github.io/core3-utils/index) &gt; [@wixc3/testing](https://wixplosives.github.io/core3-utils/testing)

## testing package

Utils for making mocha + chai testing easy and fun

## Remarks

### Env variables

- DEBUG=true/positive number env variable will set test timeouts and time scale to infinity so tests (that don't explicitly override timeout) will not time out on breakpoints

- TIMEOUT_MULTIPLIER=number env variable will multiply all test timeouts by the given number

### Test timeout manipulation

- [scaleTimeout()](https://wixplosives.github.io/core3-utils/testing.scaletimeout) multiplies timeouts when debugging or running on slow CI machines, based on TIMEOUT_MULTIPLIER and DEBUG env variables

- adjusts current test timeout (for use in non step async actions)

- [locatorTimeout()](https://wixplosives.github.io/core3-utils/testing.locatortimeout) creates a locator timeout and adjust the current test

### Steps

Steps are a convenient way to craft async tests. A step has a timeout and a description, making test timeouts easy to understand and debug. Each step timeout auto increases the test timeout, assuring the step will time out before the test

#### Available steps:

- [withTimeout()](https://wixplosives.github.io/core3-utils/testing.withtimeout) adds timeout and description to a promise

- [allWithTimeout()](https://wixplosives.github.io/core3-utils/testing.allwithtimeout) time limited Promise.all

- [waitForSpyCall()](https://wixplosives.github.io/core3-utils/testing.waitforspycall) spies on a method and wait for first call

- [waitForStubCall()](https://wixplosives.github.io/core3-utils/testing.waitforstubcall) creates a one off stub and wait for it to be called

- [step()](https://wixplosives.github.io/core3-utils/testing.step) adds a description (but not timeout) to a promise, useful for playwright locator waitFor

- [sleep()](https://wixplosives.github.io/core3-utils/testing.sleep) sleep (and adjust test time)

## Functions

| Function                                                                                                            | Description                                                                                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [adjustCurrentTestTimeout(ms)](https://wixplosives.github.io/core3-utils/testing.adjustcurrenttesttimeout)          | Add ms to current test timeout                                                                                                                                                                                                                                                                                                     |
| [adjustTestsTimeouts()](https://wixplosives.github.io/core3-utils/testing.adjustteststimeouts)                      | Adjust tests timeouts based on DEBUG and TIMEOUT_MULTIPLIER environment variables                                                                                                                                                                                                                                                  |
| [allWithTimeout(actions)](https://wixplosives.github.io/core3-utils/testing.allwithtimeout)                         | <p>Limits the time a list of promises can take</p><p>- Note: useable only within a mocha test/hook. The total test timeout will be adjusted to make sure the test will not time out waiting for this step</p>                                                                                                                      |
| [chaiRetryPlugin(\_, { flag, inspect })](https://wixplosives.github.io/core3-utils/testing.chairetryplugin)         | Plugin that allows to re-run function passed to <code>expect</code>, in order to achieve that use new <code>retry</code> method, retrying would be performed until the result will pass the chained assertion or timeout exceeded or retries limit reached. Should be applied through <code>Chai.use</code> function, for example: |
| [createDisposalGroup(name, constraints)](https://wixplosives.github.io/core3-utils/testing.createdisposalgroup)     | Creates a new disposal group                                                                                                                                                                                                                                                                                                       |
| [createTestDisposables(disposeHook)](https://wixplosives.github.io/core3-utils/testing.createtestdisposables)       | Creates a disposable group that will be disposed after the test is done                                                                                                                                                                                                                                                            |
| [debugSafeTimeout(ms, rest)](https://wixplosives.github.io/core3-utils/testing.debugsafetimeout)                    | Creates an object with [scaled](https://wixplosives.github.io/core3-utils/testing.scaletimeout) timeout and adjust the current test timeout accordingly                                                                                                                                                                            |
| [defaults()](https://wixplosives.github.io/core3-utils/testing.defaults)                                            | default values for steps of the current test                                                                                                                                                                                                                                                                                       |
| [disposeAfter(disposable, options)](https://wixplosives.github.io/core3-utils/testing.disposeafter)                 |                                                                                                                                                                                                                                                                                                                                    |
| [getTimeoutScale()](https://wixplosives.github.io/core3-utils/testing.gettimeoutscale)                              |                                                                                                                                                                                                                                                                                                                                    |
| [initAndDisposeAfter(target, options, args)](https://wixplosives.github.io/core3-utils/testing.initanddisposeafter) |                                                                                                                                                                                                                                                                                                                                    |
| [isDebugMode()](https://wixplosives.github.io/core3-utils/testing.isdebugmode)                                      |                                                                                                                                                                                                                                                                                                                                    |
| [locatorTimeout(ms)](https://wixplosives.github.io/core3-utils/testing.locatortimeout)                              |                                                                                                                                                                                                                                                                                                                                    |
| [mochaCtx()](https://wixplosives.github.io/core3-utils/testing.mochactx)                                            | Active mocha context                                                                                                                                                                                                                                                                                                               |
| [overrideDebugMode(value)](https://wixplosives.github.io/core3-utils/testing.overridedebugmode)                     | override the DEBUG environment variable for the current test                                                                                                                                                                                                                                                                       |
| [overrideTimeoutScale(scale)](https://wixplosives.github.io/core3-utils/testing.overridetimeoutscale)               | Overrides the TIMEOUT_MULTIPLIER for the current test                                                                                                                                                                                                                                                                              |
| [randomizeTestsOrder(shouldRandomize)](https://wixplosives.github.io/core3-utils/testing.randomizetestsorder)       | <p>Randomizes tests order</p><p>To avoid confusion, it can only be set once, before the testing begins (i.e. not in a running test)</p>                                                                                                                                                                                            |
| [scaleTimeout(timeout)](https://wixplosives.github.io/core3-utils/testing.scaletimeout)                             | Scales a timeout based on the TIMEOUT_MULTIPLIER and DEBUG environment variable                                                                                                                                                                                                                                                    |
| [sleep(ms)](https://wixplosives.github.io/core3-utils/testing.sleep)                                                | Resolves after ms milliseconds                                                                                                                                                                                                                                                                                                     |
| [step(action)](https://wixplosives.github.io/core3-utils/testing.step)                                              | <p>Adds a step description to a promise if it's rejected</p><p>\* - Note: useable only within a mocha test/hook. The total test timeout will be adjusted to make sure the test will not time out waiting for this step</p>                                                                                                         |
| [useSafeFakeTimers()](https://wixplosives.github.io/core3-utils/testing.usesafefaketimers)                          | Makes it easy to safely use fake timers                                                                                                                                                                                                                                                                                            |
| [waitForSpyCall(scope, method)](https://wixplosives.github.io/core3-utils/testing.waitforspycall)                   | Spies on an object method, waiting until it's called. The spy is removed once called                                                                                                                                                                                                                                               |
| [waitForStubCall(action, waitForAction)](https://wixplosives.github.io/core3-utils/testing.waitforstubcall)         | Creates a stub, then waits for it to be called                                                                                                                                                                                                                                                                                     |
| [withTimeout(action)](https://wixplosives.github.io/core3-utils/testing.withtimeout)                                | <p>Limits the time a promise can take</p><p>- Note: useable only within a mocha test/hook. The total test timeout will be adjusted to make sure the test will not time out waiting for this step</p>                                                                                                                               |

## Interfaces

| Interface                                                                                  | Description                       |
| ------------------------------------------------------------------------------------------ | --------------------------------- |
| [Info](https://wixplosives.github.io/core3-utils/testing.info)                             | Step info base, added step errors |
| [PollDefaults](https://wixplosives.github.io/core3-utils/testing.polldefaults)             | Defaults for poll steps           |
| [PromiseStep](https://wixplosives.github.io/core3-utils/testing.promisestep)               |                                   |
| [PromiseWithTimeout](https://wixplosives.github.io/core3-utils/testing.promisewithtimeout) | WithTimeout API                   |
| [StepBase](https://wixplosives.github.io/core3-utils/testing.stepbase)                     | Common step props                 |
| [StepsDefaults](https://wixplosives.github.io/core3-utils/testing.stepsdefaults)           | Test step defaults                |
| [TimeoutDefaults](https://wixplosives.github.io/core3-utils/testing.timeoutdefaults)       | Step timeout defaults             |

## Variables

| Variable                                                                                           | Description |
| -------------------------------------------------------------------------------------------------- | ----------- |
| [codeMatchers](https://wixplosives.github.io/core3-utils/testing.codematchers)                     |             |
| [DEFAULT_DISPOSAL_GROUP](https://wixplosives.github.io/core3-utils/testing.default_disposal_group) |             |

## Type Aliases

| Type Alias                                                                     | Description                                                                                                                                                                                                                                                                                                                                                                                                          |
| ------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Description](https://wixplosives.github.io/core3-utils/testing.description)   | Sets step description                                                                                                                                                                                                                                                                                                                                                                                                |
| [Predicate](https://wixplosives.github.io/core3-utils/testing.predicate)       | <p>A predicate function</p><p>Any return value other than \*\*false\*\* or throwing is considered as satisfying the predicate</p>                                                                                                                                                                                                                                                                                    |
| [RetryOptions](https://wixplosives.github.io/core3-utils/testing.retryoptions) | <p>The retry options for the <code>chaiRetryPlugin</code>.</p><p> {<!-- -->Object<!-- -->} RetryOptions {<!-- -->number<!-- -->} \[timeout\] - The maximum duration in milliseconds to wait before failing the retry operation. {<!-- -->number<!-- -->} \[retries\] - The number of times to retry the function before failing. {<!-- -->number<!-- -->} \[delay\] - The delay in milliseconds between retries.</p> |
| [Stub](https://wixplosives.github.io/core3-utils/testing.stub)                 | A generated stub                                                                                                                                                                                                                                                                                                                                                                                                     |
| [Timeout](https://wixplosives.github.io/core3-utils/testing.timeout)           | Sets step timeout                                                                                                                                                                                                                                                                                                                                                                                                    |
